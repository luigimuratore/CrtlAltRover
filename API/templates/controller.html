<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Controllo Robot</title>
    <link rel="stylesheet" href="static/style.css"> <!-- External CSS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/nipplejs/0.9.0/nipplejs.min.js"></script>
</head>
<body>
    <!-- Title -->
    <h1 class="title">ROBOT CONTROL PANEL</h1>

    <div id="gamepad">
        <!-- Top Buttons -->
        <div class="top-buttons">
            <button class="top-btn" onclick="sendCommand('start')">Start</button>
            <button class="top-btn" onclick="sendCommand('emergency')">Emergency</button>
        </div>

        <!-- Joystick Area -->
        <div id="joystick"></div>

        <!-- Action Buttons (Right Side) -->
        <div class="action-buttons">
            <button class="action-btn" onclick="sendCommand('action1')">A</button>
            <button class="action-btn" onclick="sendCommand('action2')">B</button>
            <button class="action-btn" onclick="sendCommand('action3')">X</button>
            <button class="action-btn" onclick="sendCommand('action4')">Y</button>
        </div>

        <!-- Optional Directional Buttons -->
        <div class="directional-buttons">
            <button class="dir-btn" onclick="sendCommand('up')">↑</button>
            <button class="dir-btn" onclick="sendCommand('left')">←</button>
            <button class="dir-btn" onclick="sendCommand('right')">→</button>
            <button class="dir-btn" onclick="sendCommand('down')">↓</button>
        </div>
    </div>

    <!-- JavaScript kept inline in HTML -->
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        last_action = '';

        function sendCommand(command) {
            // Check if the command is different from the previous one
            if (command === last_action) return;
            last_action = command;
            socket.emit('command', command);
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Joystick initialization
            const joystick = nipplejs.create({
                zone: document.getElementById('joystick'),
                mode: 'static',
                position: { left: '50%', top: '50%' },
                color: '#3498db',
                size: 100
            });

            joystick.on('move', function(evt, data) {
                const direction = data.direction?.angle || 'stop';
                if (direction === 'up') sendCommand('avanti');
                else if (direction === 'down') sendCommand('indietro');
                else if (direction === 'left') sendCommand('sinistra');
                else if (direction === 'right') sendCommand('destra');
            });

            joystick.on('end', function() {
                sendCommand('stop');
            });
        });
    </script>
</body>
</html>